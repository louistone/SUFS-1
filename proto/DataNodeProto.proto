syntax = "proto3";
package DataNodeProto;

service DataNodeProto {
    rpc SendHeartBeat (HeartBeatRequest) returns (HeartBeatResponse) {}
	rpc SendBlockReport (BlockReportRequest) returns (StatusResponse) {}
	rpc WriteDataBlock (DataBlock) returns (StatusResponse) {}
}

message HeartBeatRequest {
	string heartBeatString = 1;
}

message HeartBeatResponse {
	repeated DataNodeCommands cmds = 1; // Returned commands can be null
}

message BlockReportRequest {
	UUID nodeId = 1;
	BlockList blockList = 2;
}

message DataBlock {
	UUID blockId = 1;
	bytes data = 2;
	repeated DataNode dataNodes = 3; // Remaining nodes to forward data to
}

message DataNode {
	UUID id = 1;
	string ipAddress = 2;
}

// Comands sent back from namenode is response to heartbeat
message DataNodeCommands {
  enum Type {
    BlockCommand = 0;
    BlockRecoveryCommand = 1;
  }

  Type cmdType = 1;    // Type of the command

  BlockCommandProto blkCmd = 2;
}

message BlockCommandProto {
  enum Action {  
    TRANSFER = 0;   // Transfer blocks to another datanode
    INVALIDATE = 1; // Invalidate blocks
  }

  Action action = 1;
  BlockList blockList = 2;
  DataBlock dataBlock = 3;
}

message BlockList {
	repeated UUID blockId = 1; // Blocks stored on datanode
}

message StatusResponse {
	enum StatusType {
		Success = 0;
		Fail = 1;
	}
	StatusType type = 1;
}

message UUID {
	string value = 1;
}